@page "/edit-vaccine"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@layout FinalProject.Components.Layout.StaffLayout

<h3>Edit Vaccine</h3>

<EditForm method="post" Model="vaccine" OnValidSubmit="SaveChanges" FormName="editVaccine" Enhance>
    <DataAnnotationsValidator />
    @* <ValidationSummary /> *@

    <div class="mb-3">
        <label for="vaccineName" class="form-label">Vaccine Name</label>
        <InputText class="form-control" id="vaccineName" @bind-Value="vaccine.Name" />
        <ValidationMessage For="() => vaccine.Name" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="vaccineDescription" class="form-label">Description</label>
        <textarea class="form-control" id="vaccineDescription" @bind="vaccine.Description" rows="3" style="resize: vertical; overflow-y: auto;"></textarea>
        <ValidationMessage For="() => vaccine.Description" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="minAge" class="form-label">Min Age</label>
        <InputNumber class="form-control" id="minAge" @bind-Value="vaccine.MinAgeToUse" />
        <ValidationMessage For="() => vaccine.MinAgeToUse" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="maxAge" class="form-label">Max Age</label>
        <InputNumber class="form-control" id="maxAge" @bind-Value="vaccine.MaxAgeToUse" />
        <ValidationMessage For="() => vaccine.MaxAgeToUse" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="price" class="form-label">Price</label>
        <InputNumber class="form-control" id="price" @bind-Value="vaccine.Price" step="0.01" />
        <ValidationMessage For="() => vaccine.Price" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="dateCreated" class="form-label">Date Created</label>
        <InputDate class="form-control" id="dateCreated" @bind-Value="vaccine.DateCreated" />
        <ValidationMessage For="() => vaccine.DateCreated" class="text-danger" />
    </div>

    <button class="btn btn-primary float-end" type="submit">Save Changes</button>
</EditForm>

@code {
    [SupplyParameterFromQuery]
    public int Id { get; set; }

    private Vaccine vaccine;

    protected override void OnInitialized()
    {
        vaccine = GetVaccineById(Id);
    }

    private Vaccine GetVaccineById(int id)
    {
        var allVaccines = new List<Vaccine>
        {
            new Vaccine { Id = 1, Name = "Pfizer", Description = "COVID-19 vaccine", MinAgeToUse = 12, MaxAgeToUse = 16, Price = 15.99m, DateCreated = DateTime.Now },
            new Vaccine { Id = 2, Name = "Moderna", Description = "COVID-19 vaccine", MinAgeToUse = 12, MaxAgeToUse = 16, Price = 18.50m, DateCreated = DateTime.Now },
            new Vaccine { Id = 3, Name = "BCG", Description = "Tuberculosis vaccine", MinAgeToUse = 0, MaxAgeToUse = 16, Price = 5.00m, DateCreated = DateTime.Now }
        };

        return allVaccines.FirstOrDefault(v => v.Id == id);
    }

    private void SaveChanges()
    {
        NavigationManager.NavigateTo("../manage-vaccine");
    }
}
